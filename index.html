<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esports Production - Final Layout</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Teko:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --accent-yellow: #d4ff00; /* Exact color from screenshot */
            --accent-red: #ff2a2a;
            --bg-dark: #080808;
            --bg-panel: #111;
            --border-color: #333;
            --text-main: #fff;
            --text-dim: #888;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; }
        
        body { 
            font-family: 'Rajdhani', sans-serif; 
            background-color: var(--bg-dark); 
            color: var(--text-main); 
            height: 100vh; 
            overflow: hidden; 
        }

        .hidden { display: none !important; }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            position: fixed; inset: 0; z-index: 99999;
            background: #050505;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .login-box { text-align: center; }
        .login-btn {
            background: transparent; border: 2px solid var(--accent-yellow); color: var(--accent-yellow);
            padding: 15px 40px; font-family: 'Teko'; font-size: 24px; letter-spacing: 1px;
            cursor: pointer; margin: 10px; transition: 0.2s; text-transform: uppercase;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }
        .login-btn:hover { background: var(--accent-yellow); color: black; }

        /* --- ADMIN LAYOUT (GRID SYSTEM) --- */
        #admin-view { display: none; height: 100vh; display: flex; }

        /* 1. SIDEBAR */
        .sidebar {
            width: 90px; background: #0f0f0f; border-right: 1px solid var(--border-color);
            display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 15px;
        }
        .nav-item {
            width: 70px; height: 70px; background: #1a1a1a; border: 1px solid var(--border-color); border-radius: 4px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; color: var(--text-dim); transition: 0.2s;
        }
        .nav-item i { font-size: 24px; margin-bottom: 5px; }
        .nav-item span { font-size: 10px; font-weight: bold; line-height: 1; text-align: center; }
        
        /* Active State (Yellow Box) */
        .nav-item.active { background: var(--accent-yellow); color: black; border-color: var(--accent-yellow); }
        .nav-item:hover:not(.active) { border-color: #666; color: white; }

        /* 2. MAIN CONTENT AREA */
        .main-content { flex: 1; padding: 30px; display: flex; gap: 30px; overflow: hidden; }

        /* LEFT SIDE: PREVIEW */
        .preview-section { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        
        .preview-box {
            width: 100%; aspect-ratio: 16/9; background: black; border: 1px solid var(--border-color);
            position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center;
        }
        .preview-label {
            position: absolute; top: 15px; left: 15px; font-weight: bold; color: #666; font-size: 12px; letter-spacing: 1px; z-index: 10;
        }
        .live-tag {
            position: absolute; top: 15px; right: 15px; background: var(--accent-red); color: white;
            font-weight: bold; font-size: 10px; padding: 2px 6px; border-radius: 2px; z-index: 10;
        }
        
        /* The Scaled Stage */
        .stage-scaler {
            width: 1920px; height: 1080px; background: #111;
            position: absolute; transform-origin: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        #admin-video-feed { width: 100%; height: 100%; object-fit: cover; }

        /* RIGHT SIDE: CONTROLS */
        .controls-section { width: 350px; display: flex; flex-direction: column; gap: 20px; flex-shrink: 0; }

        /* Control Panels */
        .control-panel { background: transparent; border: 1px solid var(--border-color); padding: 0; }
        .cp-header {
            color: var(--accent-yellow); font-family: 'Teko'; font-size: 22px; letter-spacing: 1px;
            padding: 10px 15px; border-bottom: 1px solid var(--border-color); text-transform: uppercase;
        }
        .cp-body { padding: 15px; display: flex; flex-direction: column; gap: 15px; }

        /* Inputs */
        .input-group { margin-bottom: 5px; }
        .input-label { display: block; font-size: 11px; color: #666; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }
        .styled-input {
            width: 100%; background: #050505; border: 1px solid #333; color: white;
            padding: 10px; font-family: 'Rajdhani'; font-size: 16px; transition: 0.2s;
        }
        .styled-input:focus { border-color: var(--accent-yellow); }

        /* Toggles */
        .toggle-row {
            display: flex; justify-content: space-between; align-items: center;
            background: #050505; border: 1px solid #333; padding: 12px 15px; cursor: pointer; transition: 0.2s;
        }
        .toggle-row:hover { border-color: #555; }
        .toggle-row.active { border-color: var(--accent-yellow); background: rgba(212, 255, 0, 0.05); }
        .t-label { font-weight: bold; font-size: 14px; text-transform: uppercase; }
        .t-state { font-weight: bold; color: #444; }
        .toggle-row.active .t-state { color: var(--accent-yellow); }

        /* Red Button */
        .btn-reset {
            width: 100%; background: #2a0000; border: 1px solid #500; color: #ff5555;
            padding: 12px; font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 10px;
        }
        .btn-reset:hover { background: #400000; color: white; }

        /* Connect Button Overlay */
        .connect-overlay {
            position: absolute; inset: 0; display: flex; justify-content: center; align-items: center; z-index: 20; background: rgba(0,0,0,0.7);
        }
        .btn-connect {
            background: black; border: 1px solid var(--accent-yellow); color: var(--accent-yellow);
            padding: 10px 20px; cursor: pointer; font-weight: bold; letter-spacing: 1px;
        }

        /* --- LIVE VIEW --- */
        #live-view { position: fixed; inset: 0; background: black; z-index: 9999; display: none; }
        #live-video-feed { width: 100%; height: 100%; object-fit: cover; }
        .btn-live-start {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 20px 40px; font-size: 24px; background: black; border: 2px solid var(--accent-yellow);
            color: var(--accent-yellow); cursor: pointer; z-index: 100;
        }

        /* --- GRAPHICS (OVERLAYS) --- */
        .gfx-layer { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
        
        /* Banner */
        .banner-gfx {
            position: absolute; bottom: 80px; left: 80px; display: flex;
            transform: translateX(-120%); transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .banner-gfx.visible { transform: translateX(0); }
        .ban-icon { width: 100px; height: 80px; background: white; display: flex; justify-content: center; align-items: center; clip-path: polygon(0 0, 100% 0, 80% 100%, 0% 100%); }
        .ban-content { height: 80px; background: #111; display: flex; flex-direction: column; justify-content: center; padding: 0 50px 0 20px; margin-left: -20px; border-right: 5px solid var(--accent-yellow); z-index: -1; }
        .ban-sub { color: var(--accent-yellow); font-weight: bold; font-size: 14px; text-transform: uppercase; margin-bottom: -3px; }
        .ban-main { color: white; font-family: 'Teko'; font-size: 50px; line-height: 0.8; }

        /* Leaderboard */
        .lb-gfx {
            position: absolute; bottom: 80px; right: 80px; width: 320px;
            background: rgba(15, 15, 15, 0.95); border-left: 4px solid var(--accent-yellow);
            display: flex; flex-direction: column; transform: translateX(120%); transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .lb-gfx.visible { transform: translateX(0); }
        .lb-header { background: #222; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .lb-title { font-family: 'Teko'; font-size: 24px; color: white; }
        .lb-badge { background: var(--accent-red); color: white; font-size: 10px; font-weight: bold; padding: 2px 5px; border-radius: 2px; }
        .lb-table { width: 100%; border-collapse: collapse; }
        .lb-table th { color: #666; font-size: 10px; padding: 5px 0; border-bottom: 1px solid #333; }
        .lb-table td { padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: center; color: white; font-weight: bold;}
        .lb-row { opacity: 0; transform: translateX(20px); transition: 0.3s; }
        .lb-row.show { opacity: 1; transform: translateX(0); }
        .lb-row.wiped { opacity: 0.4; filter: grayscale(1); }
        .s-dots { display: flex; gap: 2px; justify-content: center; }
        .dot { width: 3px; height: 12px; background: white; transform: skewX(-15deg); }
        .dot.out { background: var(--accent-red); opacity: 0.5; }

    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h1 style="font-family:'Teko'; font-size:80px; color:white; line-height:0.8; margin-bottom:10px;">ESPORTS <span style="color:var(--accent-yellow)">PRO</span></h1>
            <div style="color:#666; margin-bottom:40px; letter-spacing:2px;">PRODUCTION SUITE V9</div>
            <button class="login-btn" onclick="app.enter('admin')">ADMIN PANEL</button>
            <button class="login-btn" onclick="app.enter('live')">LIVE SCREEN</button>
        </div>
    </div>

    <div id="admin-view" style="display:none;">
        <div class="sidebar">
            <div class="nav-item active" onclick="app.switchTab('control')">
                <i class="fa-solid fa-sliders"></i>
                <span>CONTROL<br>ROOM</span>
            </div>
            <div class="nav-item" onclick="app.switchTab('teams')">
                <i class="fa-solid fa-users"></i>
                <span>TEAMS<br>EDITOR</span>
            </div>
        </div>

        <div class="main-content">
            
            <div class="preview-section" id="sec-preview">
                <div class="preview-box" id="preview-container">
                    <div class="preview-label">PROGRAM PREVIEW</div>
                    <div class="live-tag">LIVE</div>
                    
                    <div class="connect-overlay" id="preview-overlay">
                        <button class="btn-connect" onclick="app.startPreviewSource()">
                            <i class="fa-solid fa-link"></i> CONNECT PREVIEW SOURCE
                        </button>
                    </div>

                    <div class="stage-scaler" id="preview-stage">
                        </div>
                </div>
            </div>

            <div class="controls-section" id="sec-controls">
                
                <div class="control-panel">
                    <div class="cp-header">MATCH SETTINGS</div>
                    <div class="cp-body">
                        <div class="input-group">
                            <span class="input-label">SUBTITLE (GROUP/DAY)</span>
                            <input id="inp-sub" class="styled-input" value="W4 - DAY 4 | GROUP B" oninput="app.sync()">
                        </div>
                        <div class="input-group">
                            <span class="input-label">MAIN TITLE</span>
                            <input id="inp-title" class="styled-input" value="MATCH 22" oninput="app.sync()">
                        </div>
                        <div class="toggle-row" id="tog-banner" onclick="app.toggle('banner')">
                            <span class="t-label">SHOW MATCH BANNER</span>
                            <span class="t-state">OFF</span>
                        </div>
                    </div>
                </div>

                <div class="control-panel">
                    <div class="cp-header">LEADERBOARD</div>
                    <div class="cp-body">
                        <div class="toggle-row" id="tog-lb" onclick="app.toggle('lb')">
                            <span class="t-label">SHOW LEADERBOARD</span>
                            <span class="t-state">OFF</span>
                        </div>
                        <button class="btn-reset" onclick="app.reset()">RESET ALL DATA</button>
                    </div>
                </div>

            </div>

            <div class="preview-section hidden" id="sec-teams" style="background:#111; border:1px solid #333; padding:20px; overflow-y:auto;">
                <div class="cp-header" style="border:none;">TEAM DATA EDITOR</div>
                <div id="editor-grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap:15px; margin-top:20px;"></div>
            </div>

        </div>
    </div>

    <div id="live-view">
        <button class="btn-live-start" id="btn-live-start" onclick="app.startLiveSource()">
            <i class="fa-solid fa-play"></i> START BROADCAST FEED
        </button>
        <div class="gfx-layer" id="live-gfx-layer"></div>
    </div>

    <script>
        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyBDyzJM5aEs0ZA08Q4vMefAUDp6Vjk-rUM",
            authDomain: "esports-manager-ab9d4.firebaseapp.com",
            databaseURL: "https://esports-manager-ab9d4-default-rtdb.firebaseio.com",
            projectId: "esports-manager-ab9d4",
            storageBucket: "esports-manager-ab9d4.firebasestorage.app",
            messagingSenderId: "191185640988",
            appId: "1:191185640988:web:89602b8c7cd948848089d9",
            measurementId: "G-7DCK83647S"
        };

        const TEAMS_INIT = Array.from({length: 16}, (_, i) => ({
            id: i, name: `TEAM ${i+1}`, kills: 0, points: 0, p: [1,1,1,1]
        }));

        // --- APP LOGIC ---
        const App = {
            state: { banner: false, lb: false, sub: "W4 - DAY 4", title: "MATCH 1", teams: TEAMS_INIT },
            mode: null,
            db: null,
            ref: null,

            async init() {
                try {
                    firebase.initializeApp(firebaseConfig);
                    this.db = firebase.database();
                    this.ref = this.db.ref('esports_prod_v9');

                    this.ref.on('value', (snap) => {
                        const val = snap.val();
                        if(val) {
                            this.state = val;
                            this.renderAll();
                        } else {
                            this.sync();
                        }
                    });
                } catch(e) { console.error("Firebase Error", e); }

                window.addEventListener('resize', () => { if(this.mode==='admin') this.fitPreview(); });
            },

            enter(mode) {
                this.mode = mode;
                document.getElementById('login-screen').classList.add('hidden');
                
                if(mode === 'admin') {
                    document.getElementById('admin-view').style.display = 'flex';
                    this.setupGraphics(document.getElementById('preview-stage'));
                    this.renderAll();
                    setTimeout(() => this.fitPreview(), 100);
                } else {
                    document.getElementById('live-view').style.display = 'block';
                    this.setupGraphics(document.getElementById('live-gfx-layer'));
                }
            },

            sync() {
                if(this.mode === 'admin') {
                    this.state.sub = document.getElementById('inp-sub').value;
                    this.state.title = document.getElementById('inp-title').value;
                }
                this.ref.set(this.state);
            },

            toggle(key) { this.state[key] = !this.state[key]; this.sync(); },
            
            reset() {
                if(confirm("Reset everything?")) {
                    this.state.teams = JSON.parse(JSON.stringify(TEAMS_INIT));
                    this.state.banner = false; this.state.lb = false;
                    this.sync();
                }
            },

            switchTab(tab) {
                const prev = document.getElementById('sec-preview');
                const ctrls = document.getElementById('sec-controls');
                const teams = document.getElementById('sec-teams');
                const navC = document.querySelectorAll('.nav-item')[0];
                const navT = document.querySelectorAll('.nav-item')[1];

                if(tab === 'control') {
                    prev.classList.remove('hidden'); ctrls.classList.remove('hidden'); teams.classList.add('hidden');
                    navC.classList.add('active'); navT.classList.remove('active');
                    setTimeout(() => this.fitPreview(), 50);
                } else {
                    prev.classList.add('hidden'); ctrls.classList.add('hidden'); teams.classList.remove('hidden');
                    navC.classList.remove('active'); navT.classList.add('active');
                    this.renderEditor();
                }
            },

            // --- RENDERERS ---
            renderAll() {
                this.renderGraphics();
                if(this.mode === 'admin') {
                    this.renderControls();
                    // Don't re-render editor constantly if typing
                    if(!document.querySelector('.editor-input:focus')) this.renderEditor();
                }
            },

            renderControls() {
                // Toggles
                const bTog = document.getElementById('tog-banner');
                const lTog = document.getElementById('tog-lb');
                
                if(this.state.banner) { bTog.classList.add('active'); bTog.querySelector('.t-state').innerText="ON"; }
                else { bTog.classList.remove('active'); bTog.querySelector('.t-state').innerText="OFF"; }

                if(this.state.lb) { lTog.classList.add('active'); lTog.querySelector('.t-state').innerText="ON"; }
                else { lTog.classList.remove('active'); lTog.querySelector('.t-state').innerText="OFF"; }

                // Inputs (Update only if not focused)
                const sInp = document.getElementById('inp-sub');
                const tInp = document.getElementById('inp-title');
                if(document.activeElement !== sInp) sInp.value = this.state.sub;
                if(document.activeElement !== tInp) tInp.value = this.state.title;
            },

            renderEditor() {
                const grid = document.getElementById('editor-grid');
                if(grid.innerHTML === "") { // Basic check to avoid redraw spam
                    grid.innerHTML = ''; 
                    this.state.teams.forEach((t, i) => {
                        const div = document.createElement('div');
                        div.style.background = '#050505'; div.style.padding='10px'; div.style.border='1px solid #333';
                        div.innerHTML = `
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                                <span style="font-weight:bold; color:#666">#${i+1}</span>
                                <input class="styled-input editor-input" value="${t.name}" style="width:120px; padding:5px;" onchange="app.updTeam(${i}, 'name', this.value)">
                            </div>
                            <div style="display:flex; gap:5px;">
                                <input type="number" class="styled-input editor-input" value="${t.kills}" style="width:50%" onchange="app.updTeam(${i}, 'kills', this.value)">
                                <input type="number" class="styled-input editor-input" value="${t.points}" style="width:50%; color:var(--accent-yellow)" onchange="app.updTeam(${i}, 'points', this.value)">
                            </div>
                            <div style="display:flex; gap:2px; margin-top:5px;">
                                ${t.p.map((s, pi) => `<div onclick="app.togP(${i},${pi})" style="flex:1; text-align:center; cursor:pointer; font-size:10px; padding:5px; background:${s?'#222':'#300'}; color:${s?'#fff':'#f55'}; border:1px solid #333">${pi+1}</div>`).join('')}
                            </div>
                        `;
                        grid.appendChild(div);
                    });
                }
            },

            updTeam(i, k, v) { this.state.teams[i][k] = (k==='name'?v:parseInt(v)); this.sync(); },
            togP(i, pi) { this.state.teams[i].p[pi] = this.state.teams[i].p[pi]?0:1; this.sync(); this.renderEditor(); },

            setupGraphics(stage) {
                stage.innerHTML = `
                    <div class="banner-gfx">
                        <div class="ban-icon"><img src="https://cdn-icons-png.flaticon.com/512/168/168732.png" width="60"></div>
                        <div class="ban-content"><div class="ban-sub"></div><div class="ban-main"></div></div>
                    </div>
                    <div class="lb-gfx">
                        <div class="lb-header"><span class="lb-title">STANDINGS</span><span class="lb-badge">LIVE</span></div>
                        <table class="lb-table"><thead><tr><th>#</th><th>TEAM</th><th>K</th><th>PTS</th><th>STS</th></tr></thead><tbody></tbody></table>
                    </div>
                `;
            },

            renderGraphics() {
                const stages = [];
                if(this.mode === 'admin') stages.push(document.getElementById('preview-stage'));
                if(this.mode === 'live') stages.push(document.getElementById('live-gfx-layer'));

                stages.forEach(el => {
                    const ban = el.querySelector('.banner-gfx');
                    ban.querySelector('.ban-sub').innerText = this.state.sub;
                    ban.querySelector('.ban-main').innerText = this.state.title;
                    if(this.state.banner) ban.classList.add('visible'); else ban.classList.remove('visible');

                    const lb = el.querySelector('.lb-gfx');
                    if(this.state.lb) lb.classList.add('visible'); else lb.classList.remove('visible');

                    const tbody = el.querySelector('tbody');
                    const sorted = [...this.state.teams].sort((a,b) => b.points - a.points);
                    tbody.innerHTML = sorted.map((t, i) => `
                        <tr class="lb-row show ${t.p.every(x=>x===0)?'wiped':''}">
                            <td style="color:#666">${i+1}</td>
                            <td style="text-align:left; padding-left:10px;">${t.name}</td>
                            <td style="color:#aaa">${t.kills}</td>
                            <td style="color:var(--accent-yellow); font-size:18px;">${t.points}</td>
                            <td><div class="s-dots">${t.p.map(s=>`<div class="dot ${s?'':'out'}"></div>`).join('')}</div></td>
                        </tr>
                    `).join('');
                });
            },

            fitPreview() {
                const box = document.getElementById('preview-container');
                const stage = document.getElementById('preview-stage');
                if(!box || !stage) return;
                const scale = Math.min(box.clientWidth/1920, box.clientHeight/1080) * 0.95;
                stage.style.transform = `scale(${scale})`;
            },

            // --- SCREEN SHARE ---
            async startPreviewSource() {
                try {
                    const stream = await navigator.mediaDevices.getDisplayMedia({video: {cursor:"always"}, audio:false});
                    const v = document.createElement('video'); v.id = "admin-video-feed";
                    v.srcObject = stream; v.autoplay = true;
                    document.getElementById('preview-stage').prepend(v);
                    document.getElementById('preview-overlay').style.display = 'none';
                } catch(e) { alert("Preview requires HTTPS or Localhost."); }
            },

            async startLiveSource() {
                try {
                    const stream = await navigator.mediaDevices.getDisplayMedia({video: {cursor:"always"}, audio:false});
                    const v = document.createElement('video'); v.id = "live-video-feed";
                    v.srcObject = stream; v.autoplay = true;
                    document.getElementById('live-view').insertBefore(v, document.getElementById('live-gfx-layer'));
                    document.getElementById('btn-live-start').style.display = 'none';
                } catch(e) { alert("Live feed requires HTTPS or Localhost."); }
            }
        };

        window.onload = () => App.init();
    </script>
</body>
</html>
